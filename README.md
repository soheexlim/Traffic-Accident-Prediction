# Final Project: Predicting Traffic Accidents Based on Weather and Time Data in Greater Boston Area

* The model folder includes a pre-trained Random Forest model saved as a .joblib file, which is automatically used when running the application. To set up and run the application, simply execute the provided Makefile without the need to create a new model. If you wish to create your own model, download the notebook and Archive.zip file. The notebook contains the code used to develop the Random Forest model, while the Archive.zip includes the necessary datasets. Extract the zip file, update the notebook's file paths to match your local setup, and execute the notebook to generate a new model for use in the application.

## 1. Project Overview
This project aims to predict the likelihood of traffic accidents in the Greater Boston Metropolitan Area by leveraging historical crash data enriched with weather and time-related features. Using machine learning models, the goal is to estimate the likelihood of accidents occuring under various conditions, such as rain, nighttime, or rush hour. 

The insights generated from this project can be used by transportation agencies, city planners, and navigation services to provide actionable recommendations or warnings for accident-prone areas and times. By identifying key factors influencing accident risks, this project seeks to contribute to safer road systems and more informed decision-making.

---

## 2. Goals and Objectives

Traffic accidents are influenced by a range of environmental and temporal factors, making predictive modeling a valuable tool for proactive safety measures. The **primary goal** of this project is to develop a machine learning model capable of predicting the likelihood of accidents based on key features such as weather, time of day, road conditions, and rush hour status. For example, the model might estimate that there is a 70% chance of an accident at a specific location on a rainy weekday during rush hour.

In addition to prediction, the project aims to identify the most significant factors influencing accidents. The **secondary goal** involves analyzing the impact of variables like rain combined with nighttime driving or rush hour to understand how these combinations elevate risks. These insights will be critical for designing effective interventions.

---

## 3. Data Sources and Features

### Data Sources
The dataset merges crash records from 2022 and 2023, sourced from [Massachusetts Crash Portal](https://massdot-impact-crashes-vhb.opendata.arcgis.com/). Each crash record includes details such as location, date, time, weather conditions, and road surface conditions. Temporal features like holidays and rush hour indicators were added using external libraries and engineering techniques. Weather data was simplified into categories (e.g., rain, clear, snow) to enhance interpretability.

### Key Features
The dataset includes the following critical features:
- **Crash Timing**: Date, time, and derived indicators like day of the week, nighttime, and rush hour.
- **Weather Conditions**: Simplified categories such as clear, rain, snow, and fog.
- **Road Conditions**: Surface conditions, junction types, and ambient lighting.
- **Interaction Terms**: Combined features like weather during rush hour or weather at night.

By combining these features, the dataset provides a comprehensive foundation for analyzing accident risks under various conditions.

---

## 4. Data Processing and Feature Engineering

### Initial Data Cleaning
The raw dataset originally contained over 120 columns, many of which were irrelevant or incomplete. Columns with over 50% missing values, redundant identifiers, or excessive granularity (e.g., street names) were removed, leaving a streamlined set of 16 key variables. Additionally, the dataset was filtered to include only crashes within the Greater Boston Metropolitan Area, using a predefined list of cities and towns.

### Feature Engineering
To enhance the predictive power of the dataset, several new features were engineered:
- **Datetime Features**: 
  - `CRASH_DATETIME` was created by combining date and time fields. From this, additional features such as `DAY_OF_WEEK`, `IS_NIGHT`, `IS_RUSH_HOUR`, and `IS_HOLIDAY` were derived.
- **Weather Simplification**:
  - Weather descriptions were grouped into broader categories like "Rain," "Clear," and "Snow," and encoded numerically.
- **Speed Limit Ranges**:
  - Speed limits were categorized into `<30 mph`, `30–50 mph`, and `>50 mph` ranges to simplify analysis.
- **Interaction Terms**:
  - Features like `WEATHER_RUSH_HOUR` and `WEATHER_NIGHT` were created to capture the combined effects of weather and temporal conditions.

### Synthetic Data Generation
Since the dataset primarily consisted of crash records, it was imbalanced. To address this, synthetic non-accident data was generated by simulating realistic conditions where crashes were less likely. Weighted probabilities were assigned to features like weather, time of day, and road surface conditions, ensuring the synthetic data reflected real-world distributions.

---

## 5. Data Modeling

### Approach to Modeling
The dataset was merged, shuffled, and split into training (80%) and testing (20%) subsets. Multiple machine learning models were employed to predict the likelihood of accidents, with a focus on optimizing accuracy and reliability.

### Models Used
1. **Logistic Regression**:
   - A simple baseline model for binary classification.
2. **Random Forest**:
   - Optimized using Bayesian hyperparameter tuning to enhance accuracy and reduce overfitting.
3. **Gradient Boosting (XGBoost)**:
   - Captures non-linear relationships between features and the target variable.
4. **Neural Network**:
   - A deep learning model with two hidden layers and dropout regularization to prevent overfitting.
5. **Stacking Classifier**:
   - Combines predictions from Random Forest, XGBoost, and Gradient Boosting using Logistic Regression as a meta-classifier.

### Calibration and Evaluation
To improve the reliability of probability predictions, isotonic and sigmoid calibrations were applied to the models. Evaluation metrics included accuracy, F1 score, and confusion matrices to assess both precision and recall. 

---

## 6. Preliminary Visualizations and Insights

### Key Insights
- **Accidents During Rush Hour**:
  - Rush hour significantly increases the likelihood of accidents, especially during adverse weather conditions.
- **Nighttime Accidents**:
  - Though less frequent, nighttime accidents tend to be more severe, possibly due to reduced visibility and driver fatigue.
- **Weather Conditions**:
  - Rain and snow were found to increase accident risks compared to clear weather.

### Sample Visualizations
#### Holidays and Rush Hour
![Accidents by Rush Hour](https://github.com/user-attachments/assets/70507ae4-2b5e-4b24-b651-a55ce0dddab1)

#### Ambient Light and Road Surface Condition
![Correlation Heatmap](https://github.com/user-attachments/assets/6b148ea5-7b51-4089-b353-76524613e535)

#### Interaction Terms: Weather and Rush Hour, Weather and Time of Day (Day or Night)
![Weather and Rush Hour](https://github.com/user-attachments/assets/3f98db15-184b-4fb2-99ae-9e24d2397093)

---

## 7. Evaluation Metrics and Results

### Metrics Used
1. **Accuracy**: Proportion of correct predictions.
2. **F1 Score**: Harmonic mean of precision and recall, particularly valuable for imbalanced datasets.
3. **Confusion Matrix**: Breakdown of true/false positives and negatives.

### Baseline Accuracy
A naïve model predicting the majority class (no accidents) achieved a baseline accuracy of approximately 70%. Models significantly outperformed this baseline.

---

## 8. Observations and Results

### Key Observations:
1. **Accidents by Weekend vs. Weekday**:
   - The majority of accidents occur on weekdays, reflecting higher traffic volumes and activity levels during workdays compared to weekends.

2. **Accidents During Day vs. Night**:
   - Daytime accidents significantly outnumber nighttime accidents, likely due to increased vehicular activity during daylight hours. However, nighttime accidents may involve heightened risks due to reduced visibility.

3. **Accidents on Holidays vs. Non-Holidays**:
   - Non-holiday days see substantially more accidents compared to holidays. This discrepancy might be due to decreased traffic volumes and activities on holidays.

4. **Accidents by Weather Condition**:
   - Clear weather conditions account for the majority of accidents, primarily because clear weather is the most common condition. Adverse weather conditions like rain and snow, though less frequent, present increased risks for drivers.

5. **Accidents During Rush Hour vs. Non-Rush Hour**:
   - Non-rush hours slightly surpass rush hours in terms of accident frequency. However, rush hours still account for a significant proportion of accidents due to traffic congestion and peak commuting times.

6. **Accidents by Speed Limit**:
   - Speed ranges between 30-50 mph have the highest accident frequency, followed by areas with speed limits under 30 mph. High-speed areas (greater than 50 mph) show fewer accidents but may be associated with more severe outcomes.

7. **Accidents by Ambient Light Condition**:
   - Daylight accounts for the majority of accidents, followed by dark conditions with roadway lighting. This trend underscores the importance of visibility in preventing accidents.

8. **Accidents by Traffic Control Device**:
   - Most accidents occur at locations with no traffic controls, followed by intersections with traffic control signals and stop signs. These findings suggest areas for potential infrastructure improvement.

9. **Interactions Between Features**:
   - Clear weather dominates accidents across rush and non-rush hours. Adverse weather conditions such as rain and snow have fewer recorded accidents but pose elevated risks when they occur.
   - Nighttime accidents, while less frequent than daytime, are significant during adverse weather conditions, indicating the compounded risk of poor visibility and challenging weather.

### Model Performance:
The **Random Forest model** demonstrated exceptional performance in predicting binary crash outcomes (likely to crash or not likely to crash). Key metrics from the evaluation include:

- **Confusion Matrix**:
  - **True Negatives**: 15,080
  - **True Positives**: 15,150
  - **False Negatives**: 3
  - **False Positives**: 0

- **Classification Report**:
  - **Precision**: 1.00 for both crash and non-crash classes
  - **Recall**: 1.00 for both crash and non-crash classes
  - **F1-Score**: 1.00 for both classes
  - **Overall Accuracy**: 100%

While the model shows near-perfect metrics, these results must be interpreted cautiously due to potential biases introduced by synthetic data and the dataset's characteristics.

### Feature Importance:
The model identified key predictors of crash likelihood:
- **Time of Day**: Morning, evening, and night hours show varying risk levels.
- **Weather Conditions**: Adverse conditions like rain and snow impact crash likelihood.
- **Road Surface Condition**: Dry, wet, or icy surfaces influence risk levels.
- **Speed Limit**: Medium-speed areas (30-50 mph) are associated with higher accident frequencies.

Despite the model's apparent robustness, its limitations suggest a need for further refinement and validation.

---

## 9. Challenges and Limitations

### Challenges:
1. **Data Imbalance**:
   - The dataset exhibited significant imbalance, with certain categories (e.g., clear weather and daylight) dominating, which could bias model predictions.

2. **Missing and Incomplete Data**:
   - Some columns had to be dropped due to missing or irrelevant data, potentially limiting the scope and accuracy of the analysis.

3. **Simplified Feature Encoding**:
   - Encoding categorical variables and simplifying weather conditions may have led to the loss of nuanced information, reducing model precision.

4. **Challenges with Mapping APIs**:
   - It was difficult to find a mapping API that accurately bounded the Greater Boston districts and cities. As a result, we manually curated a dropdown menu for location selection, which, while functional, lacks the interactivity and visual appeal of a map-based interface.

### Limitations:
1. **Use of Synthetic Data**:
   - Synthetic data was generated to create non-accident occurrences since the dataset only included crash occurrences. This approach introduced limitations:
     - **Bias in Synthetic Data**: The synthetic data relied on assumptions and heuristics that might not accurately represent real-world non-accident scenarios.
     - **Model Overconfidence**: The synthetic data may have led to extreme predicted probabilities, especially if it lacked variability or subtle patterns.

2. **Extremes in Predicted Probabilities**:
   - Our initial plan to return accident probabilities was abandoned because the results were often extreme (close to 0 or 1), reducing practical interpretability. This limitation arose from the dataset's imbalance and the reliance on synthetic data.

3. **Binary Classification Workaround**:
   - To address the issues with predicted probabilities, we implemented binary classification (likely to crash or not likely to crash). While this improved interpretability, it sacrificed the detailed insights that probabilities could offer.

4. **Generalizability**:
   - The model is specific to the Greater Boston area and may not generalize well to other regions with different road, traffic, and weather conditions.

5. **Real-Time Applicability**:
   - The model uses static historical data for predictions and does not integrate real-time traffic or weather updates. Extending the model for dynamic predictions would require additional development.

6. **Severity of Accidents**:
   - The analysis focused on the likelihood of accidents without considering accident severity, which limits its utility for prioritizing responses.

7. **Loss of Nuanced Information**:
   - Simplifications in feature engineering, such as merging weather conditions and encoding categories, may obscure complex relationships and reduce the richness of insights.

8. **Generalization Risk**:
   - The reliance on synthetic data and historical patterns may cause the model to underperform in real-world scenarios where conditions differ significantly from the training data.

### Future Directions:
- Improve data collection to include non-accident cases and handle missing values more effectively.
- Explore advanced modeling techniques, such as neural networks, to capture complex feature interactions.
- Incorporate real-time data to enable dynamic predictions and improve practical applicability.
- Expand the model to differentiate between accident severity levels for more actionable insights.
- Develop an interactive map for city/town selection to enhance user experience.

---

## Midterm Report and Presentation
- **YouTube Link**: [https://youtu.be/xDtrSEpDA7s](https://youtu.be/xDtrSEpDA7s)

---

